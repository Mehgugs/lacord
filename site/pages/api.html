

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta property="og:title" content="lacord.api"/>
<meta property="og:description" content="This module is used to connect to discord’s restful api over http. All api methods must be called inside a cqueues managed coroutine."/>
<meta name="theme-color" content="#e9535f">
    
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width height=device-height initial-scale=1">
        <title>Lacord Docs</title>
        <link rel="stylesheet" href="../docs.css">
        <link rel="stylesheet" href="../highlight.css">
        <script src="https://kit.fontawesome.com/e5bb70e554.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script>
        <script>
            function openNav() {
                document.getElementById("sidebar").className = "fit";
                document.getElementById("content").style.marginLeft  = `${document.getElementById("sidebar").getBoundingClientRect().width}px`;
                document.getElementById("btn").className = "hide";
            }

            function closeNav() {
                document.getElementById("sidebar").className = "zero"
                document.getElementById("content").style.marginLeft = "0"
                document.getElementById("btn").className = "fas fa-bars";
            }
            let state = false;
            function toggleNav() {
                if (state) closeNav(state = false);
                else openNav(state = true);
            }
            window.onresize = () => {
                if (state)
                    document.getElementById("content").style.marginLeft  = `${document.getElementById("sidebar").getBoundingClientRect().width}px`;
            }
            window.onload = () => {
                if (window.location.hash === "#open") {
                    toggleNav();
                }
            }
        </script>
    </head>
    <body>
        <div id="sidebar" class="zero">
            <button id="btn2" class="fas fa-times" onclick="toggleNav()"></button>
            <a class="top" href="../index.html">Readme</a>
<div class="sidebar-sep"> Modules </div>
<a class="active nav" href="api.html#open">lacord.api</a>
<a class="nav" href="cdn.html#open">lacord.cdn</a>
<a class="nav" href="cli.html#open">lacord.cli</a>
<a class="nav" href="const.html#open">lacord.const</a>
<a class="nav" href="outgoing-webhook-server.html#open">lacord.outgoing-webhook-server</a>
<a class="nav" href="shard.html#open">lacord.shard</a>
<a class="nav" href="util.html#open">lacord.util</a>
<a class="nav" href="util.intents.html#open">lacord.util.intents</a>
<a class="nav" href="util.json.html#open">lacord.util.json</a>
<a class="nav" href="util.logger.html#open">lacord.util.logger</a>
<a class="nav" href="util.mutex.html#open">lacord.util.mutex</a>
<a class="nav" href="util.session-limit.html#open">lacord.util.session-limit</a>
<a class="nav" href="util.uint.html#open">lacord.util.uint</a>
<div class="sidebar-sep"> Exports </div>
<a class="nav" href="#USER_AGENT">USER_AGENT</a>
<a class="nav" href="#URL">URL</a>
<a class="nav" href="#init">init</a>
<a class="nav" href="#api:method_name">api:method_name</a>
<a class="nav" href="#api:capture">api:capture</a>
<a class="nav" href="#webhook_init">webhook_init</a>
<a class="nav" href="#with_reason">with_reason</a>
        </div>

        <button id="btn" class="fas fa-bars" onclick="toggleNav()"></button>
        <div id="content">
            <h2 id="lacord.api">lacord.api  <a href="../source/api.html">[src]</a></h2>
<p>This module is used to connect to discord’s restful api over http. All api methods must be called inside a cqueues managed coroutine.</p>
<h4 id="ratelimits">Ratelimits</h4>
<p>The api client will automatically handle ratelimits for you. 429s may still be encountered and will be handled as well.</p>
<h4 id="USER_AGENT"><em>string</em> <code>USER_AGENT</code></h4>
<p>The lacord user-agent used by all clients.</p>
<h4 id="URL"><em>string</em> <code>URL</code></h4>
<p>The api url used by the client.</p>
<h3 id="api"><em>api</em></h3>
<p>This type has methods for interacting with the discord rest api.</p>
<h4 id="init"><em>api</em> <code>init(options)</code></h4>
<p>This initializes the api client.</p>
<ul>
<li><em>{string, string}</em> <code>options.client_credentials</code> Set this field to to use Basic authentication for the client credentials grant. It should be a sequence of your id and client secret.</li>
<li><em>string</em> <code>options.token</code> Set this field to use either a Bearer or Bot token for authentication. Mutually exclusive with <code>client_credentials</code>.</li>
<li><em>boolean</em> <code>options.track_ratelimits</code> Set this flag to track ratelimit information. This will be available in the <code>.rates</code> field of the client.</li>
<li><em>number (seconds)</em> <code>options.route_delay</code> Set this field to set a lower bound on the delay calculated when making requests. This is used to make the requests have more even availability but will reduce the throughput of the client.</li>
<li><em>number (seconds)</em> <code>options.api_timeout</code> Set this field to control the request timeout.</li>
<li><em>number (http version)</em> <code>options.api_http_version</code> Set this field to control the http version used by the request client.</li>
<li><em>boolean</em> <code>options.accept_encoding</code> Set this flag to control whether the client should accept compressed data from discord.</li>
</ul>
<h4 id="api:method_name"><em>boolean, applicaion/json|true, string, table</em> <code>api:method_name(...)</code></h4>
<p>All requests you can make via this client are methods of the form: <code>api:&lt;discord name snake cased&gt;</code>. For example “Create message” would be found at <code>api:create_message</code>. Consult discord’s official documentation for a list of available api methods. All these methods return: a success boolean; response data decoded as json; an error message if success was false; and a table of errors if discord sent that in the error response. All of these functions accept arguments in the following way: first the route parameters as strings in the order they appear in the uri; then the payload if the route accepts a body; then the query if the route accepts a query; and finally a list of content typed objects to attach as files in a multipart request. Note that some endpoints may accept a query without a payload, in which case the arguments will look like: <code>route-parameters..., query</code>. In the case of <code>204</code> the second return value will simply be true. This client will only attempt to retry these requests on timeout, or if a ratelimit is hit. In the latter case the client will wait an appropriate amount of time before continuing to make the request.</p>
<h5 id="note">NOTE</h5>
<p>The <a href="https://discord.com/developers/docs/resources/guild-scheduled-event">“Guild scheduled events”</a> methods break the naming convention used by lacord: “List scheduled events for guild” would be found at <code>list_scheduled_guild_events</code>, and “Get Guild scheduled events” at <code>get_scheduled_guild_events</code>. This was done to improve readability because the names are rather long.</p>
<h4 id="api:capture"><em>api.capture</em> <code>api:capture()</code></h4>
<p>This function will create a capture object which can be used to safely sequence multiple requests together.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- somewhere in a cqueues coroutine...</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a> <span class="kw">local</span> api <span class="op">=</span> <span class="fu">require</span><span class="st">&quot;lacord.api&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">local</span> discord_api <span class="op">=</span> api<span class="op">.</span>init<span class="op">{</span>blah<span class="op">}</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a> <span class="kw">local</span> <span class="cn">R</span> <span class="op">=</span> discord_api</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">:</span>capture<span class="op">()</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>   <span class="op">:</span>get_gateway_bot<span class="op">()</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">:</span>get_current_application_information<span class="op">()</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="cn">R</span><span class="op">.</span>success <span class="cf">then</span> <span class="co">-- ALL methods succeeded</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>   <span class="kw">local</span> results_list <span class="op">=</span> <span class="cn">R</span><span class="op">.</span>result</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>   <span class="kw">local</span> <span class="cn">A</span><span class="op">,</span> <span class="cn">B</span><span class="op">,</span> <span class="cn">C</span> <span class="op">=</span> <span class="cn">R</span><span class="op">:</span>results<span class="op">()</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>   <span class="kw">local</span> why <span class="op">=</span> <span class="cn">R</span><span class="op">.</span>error</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>   <span class="kw">local</span> partial <span class="op">=</span> <span class="cn">R</span><span class="op">.</span>result</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- There may be partial results collected before the error, you can use this to debug.</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>   <span class="cn">R</span><span class="op">:</span>some_method<span class="op">()</span> <span class="co">-- If there&#39;s been a failure, calls like this are noop&#39;d.</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<h4 id="webhook_init"><em>api.webhook</em> <code>webhook_init(webhook_token)</code></h4>
<p>Create a client suitable for executing webhooks. The only methods this client has access to are the webhook methods, and you will still need to provide the id as the first parameter of those methods, but the token will be inserted into the argument list for you internally.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> hook <span class="op">=</span> api<span class="op">.</span>webhook_init<span class="op">(</span>webhook_token<span class="op">)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>hook<span class="op">:</span>execute_webhook<span class="op">(</span>webhook_id<span class="op">,</span> <span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    content <span class="op">=</span> line<span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    username <span class="op">=</span> username<span class="op">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span></code></pre></div>
<h4 id="with_reason"><em>string</em> <code>with_reason(text)</code></h4>
<p>Adds a new contextual audit log reason to the currently running cqueues coroutine. When requests are made in this coroutine which accept an audit log reason they will pull a reason from the thread’s reason if one is available:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- somewhere in a cqueues coroutine...</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> api <span class="op">=</span> <span class="fu">require</span><span class="st">&quot;lacord.api&quot;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> discord_api <span class="op">=</span> api<span class="op">.</span>init<span class="op">{</span>blah<span class="op">}</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>api<span class="op">.</span>with_reason <span class="st">&quot;I&#39;m doing this because I can!&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>discord_api<span class="op">:</span>create_guild_ban<span class="op">(...)</span> <span class="co">-- this will have the reason defined above.</span></span></code></pre></div>

        </div>
        <a href="https://github.com/Mehgugs/lacord" class="footer">Lacord 1637789515</a>
    </body>
</html>

